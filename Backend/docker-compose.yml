services:
  # redis:
  #   image: redis:7-alpine
  #   ports:
  #     - "6379:6379"
  clientservice-api:
    build:
      # IMPORTANT: use repo root as build context so project references (BaseService, Application, Infrastructure) are available
      context: .
      dockerfile: Services/ClientService/ClientService.API/Dockerfile
    # depends_on:
    #   - redis
    env_file:
      - .env
    environment:
      ASPNETCORE_ENVIRONMENT: ${ASPNETCORE_ENVIRONMENT:-Development}
      ASPNETCORE_URLS: "http://+:7217;https://+:7218"
      # Kestrel cert config (MUST be under "Kestrel:", not "ASPNETCORE_Kestrel:")
      Kestrel__Certificates__Default__Path: /https/aspnetapp.pfx
      Kestrel__Certificates__Default__Password: ${HTTPS_CERT_PASSWORD:-123456}
      CLIENT_SERVICE_DB: ${CLIENT_SERVICE_DB}
      REDIS_CACHE_CONNECTION: ${REDIS_CACHE_CONNECTION}
      CLIENT_ID: ${CLIENT_ID:-service_client}
      CLIENT_SECRET: ${CLIENT_SECRET:-EduSmartAI-Capstone-Project}
      JWT_AUDIENCE: ${JWT_AUDIENCE:-service_client}
      AUTH_SERVICE_URL: ${AUTH_SERVICE_URL:-https://localhost:7218/}
    ports:
      - "7217:7217"
      - "7218:7218"
    volumes:
      # Keep it simple/reliable: mount the repo-local cert folder (./.https/aspnetapp.pfx).
      # This avoids Windows path/env quirks in Docker Desktop.
      - ./.https:/https:ro

